
## 目录结构

```plaintext
netSocket/
├── Makefile            # 根目录的 Makefile
├── operation.log       # 根目录的 ftp 服务器操作日志
├── dbconf.json         # 根目录的 ftp 服务器数据库连接信息
├── server_files/       # ftp 服务器中存在的资源文件
│   ├── cal.c      
│   └── test.txt        # 客户端可执行文件
├── bin/                # 存放生成的可执行文件
│   ├── server_ftp      # 服务器端可执行文件
│   └── client_ftp      # 客户端可执行文件
├── obj/                # 存放生成的对象文件(.o)
├── src/                # 所有源文件的根目录
│   ├── server/         # 服务器端源文件
│   │   ├── server.c
│   │   ├── initServer.c
│   │   ├── checkoutUser.c
│   │   ├── log_operation.c
│   │   ├── copeUpload.c
│   │   ├── copeDownload.c
│   │   └── copeList.c
│   ├── client/         # 客户端源文件
│   │   ├── client.c
│   │   ├── connect_to_server.c
│   │   ├── init_connectServer.c
│   │   ├── upload_file.c
│   │   ├── download_file.c
│   │   └── list_files.c
│   └── common/         # 服务器和客户端共享的公共模块
│       ├── data_checkout.c
│       ├── get_filename.c
│       └── sendjson.c
└── include/            # 头文件存放目录
    ├── server.h        # 服务器端头文件
    ├── client.h        # 客户端头文件
    └── common.h        # 公共头文件        
```

     

## 编译运行


- 修改`dbconf.json` 文件，`db_ip` 修改为数据库服务器，即所在的电脑 `ip`


```shell
# 编译
make

# 清除可执行文件
make clean
```

```shell
# 运行
# 服务器端
./bin/server_ftp

# 客户端
./bin/cilent_ftp
```


## 简介

- 实现的是一个 ftp 服务器功能，包含了上传、下载和查看服务器中文件的功能
- 加入了数据库功能，用户验证登录 ftp 服务器的用户名和密码是否匹配
- 使用了 `CJson` 进行数据的封装，用于实现 ftp 服务器和客户端之间的信息反馈，统一数据格式
- 可以上传图片、mp3文件、文本文件等多种形式文件，速率也能保证
- 处理了上传文件和下载文件的文件同名问题，处理手段是加编号，如 `test(1).c` 形式，而服务器端同名文件供给客户端选择是否覆盖文件
    - 由于多个客户端可能上传同一个文件，所以上传文件的文件命名使用了加用户名的方式，如 `test(xingzhu).c` 这种形式
    - 这样保证客户端选择覆盖是覆盖自己上传的文件，而不是其他客户端上传的文件被覆盖
- 进行了数据的完整性检验，这里使用的是弱校验方式 (校验和)，是为了保证速率

**不足之处**:
- 客户端是使用的本地网络下实现的，只有命令行
- 后续会使用图形化界面，使用 Qt 结合做个客户端


## 开发日志


- 2024/9/11  
    - [x] 新增处理中文乱码问题
- 2024/9/18  
    - [x] 新增处理大文件一次性无法完全传输问题，使用分块传输思想解决
-  2024/9/25  
    - [x] 新增数据完整性检验部分，使用的 MD5 码检验
- 2024/10/10 
    - [x] 新增 json 数据统一格式，用于客户端和服务器端信息相互之间的反馈
    - [x] 新增数据库API，用于判断用户名和密码是否匹配
    - [x] 整理所有的源文件，整理成模块，可读性提升
- 2024/10/11 
    - [x] 修复成功上传和下载图片、视频等BUG
    - [x] 新增从服务器下载文件可以指定路径，或默认为当前工作目录
- 2024/10/12 
    - [x] 修复大容量慢问题，提高了速率
- 2024/10/16 
    - [x] 修复了之前大容量因网络原因，会出现频繁丢包行为，减少了传输的数据包大小，这个需要注意，因为网络通信中数据包大小有限制，不然会出现频繁丢包，这里呈现的就是频繁重传数据
    - [x] 修复了只有文件所有者才具有覆盖文件的权限，用户不能覆盖非本用户上传的文件，这里修改的是文件名加用户作为服务器端文件名，如cal(xingzhu).c
- 2024/10/23 
    - [x] 修复了完整性代码，删除了MD5校验，数据传输部分不需要这么强的校验，使用若校验: 校验和校验，而且不用每一部分都去校验，最终总文件校验即可，虽然若校验可能30%~40%部分校验不到，但是数据传输的高速很重要，发送数据错误几率低，MD5检验是应用层用户自己手动需要校验的变校验
    - [x] 增加了发送校验和之间的反馈，需要先收到对方的准备好接收数据，才发送数据
    - [x] 增加了服务器和客户端之间信息完整性，比如服务器端知道客户端接收完毕等之类信息，这之中解决了很多隐含的BUG

## 运行演示

### 服务器端

<img src="https://bu.dusays.com/2024/10/25/671bb5dc0a70c.png" alt="服务器端" width="450px" height="200px"></img>

<img src="https://bu.dusays.com/2024/10/25/671bb5dd467c8.png" alt="服务器端" width="450px" height="300px"></img>

<img src="https://bu.dusays.com/2024/10/25/671bb5de5c199.png" alt="服务器端" width="250px" height="230px"></img>



### 客户端

<img src="https://bu.dusays.com/2024/10/25/671bb5df798e1.png" alt="服务器端" width="570px" height="180px"></img>
